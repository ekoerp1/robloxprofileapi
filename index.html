<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Profile Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <style>
      .hidden {
        display: none;
      } /* Utility class to hide sections */
      .selected {
        border-b-2 border-black;
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="max-w-4xl mx-auto p-4">
      <!-- Profile Header -->
      <div class="flex flex-col sm:flex-row items-center space-x-0 sm:space-x-4 space-y-4 sm:space-y-0">
        <img
          alt="Profile picture of user"
          class="w-24 h-24 rounded-full"
          id="profile-picture"
          src="https://placehold.co/150x150"
        />
        <div class="text-center sm:text-left">
          <h1 class="text-3xl font-bold" id="display-name">Display Name</h1>
          <p class="text-gray-500 text-lg" id="user-handle">@UserHandle</p>
          <div class="flex justify-center sm:justify-start space-x-4 mt-2">
            <span class="text-gray-700" id="friends">0 Friends</span>
            <span class="text-gray-700" id="followers">0 Followers</span>
            <span class="text-gray-700" id="following">0 Following</span>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="mt-4 flex space-x-4 border-b">
        <a id="about-tab" class="py-2 px-4 text-gray-700 selected cursor-pointer">About</a>
        <a id="creations-tab" class="py-2 px-4 text-gray-700 cursor-pointer">Creations</a>
      </div>

      <!-- About Section -->
      <div id="about-section" class="mt-4">
        <h2 class="text-lg font-bold">About</h2>
        <p class="text-gray-700" id="about">About text goes here.</p>

        <!-- Currently Wearing Section -->
        <div class="mt-4">
          <h2 class="text-lg font-bold">Currently Wearing</h2>
          <div class="flex flex-col sm:flex-row space-x-0 sm:space-x-4 mt-2">
            <div class="w-full sm:w-1/2 bg-gray-200 p-4">
              <img
                alt="3D view of current outfit"
                class="w-full h-full"
                id="current-outfit"
                src="https://placehold.co/200x200"
              />
            </div>
            <div class="w-full sm:w-1/2 grid grid-cols-3 gap-2" id="currently-wearing-items">
              <img alt="Item 1" class="w-full h-full" src="https://placehold.co/50x50" />
              <img alt="Item 2" class="w-full h-full" src="https://placehold.co/50x50" />
              <img alt="Item 3" class="w-full h-full" src="https://placehold.co/50x50" />
              <img alt="Item 4" class="w-full h-full" src="https://placehold.co/50x50" />
              <img alt="Item 5" class="w-full h-full" src="https://placehold.co/50x50" />
              <img alt="Item 6" class="w-full h-full" src="https://placehold.co/50x50" />
            </div>
          </div>
        </div>

        <!-- Statistics Section -->
        <div class="mt-4">
          <h2 class="text-lg font-bold">Statistics</h2>
          <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-4 text-center">
            <div>
              <p class="text-gray-500">Join Date</p>
              <p class="text-gray-700" id="join-date">Join Date</p>
            </div>
            <div>
              <p class="text-gray-500">Place Visits</p>
              <p class="text-gray-700" id="place-visits">Place Visits</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Creations Section -->
      <div id="creations-section" class="mt-4 hidden">
        <h2 class="text-lg font-bold">Experiences</h2>
        <div
          class="flex flex-col sm:flex-row items-center sm:items-start space-x-0 sm:space-x-4 mt-2 border border-gray-300 p-4"
        >
          <img alt="Roblox game thumbnail" class="w-36 h-36" src="https://placehold.co/150x150" />
          <div class="text-center sm:text-left mt-4 sm:mt-0">
            <h3 class="text-xl font-bold" id="place-name">Place Name</h3>
            <p class="text-gray-500" id="place-description">Place description goes here.</p>
            <div class="flex justify-center sm:justify-start space-x-4 mt-2">
              <div>
                <p class="text-lg font-bold">Active</p>
                <p class="text-gray-500" id="active-count">0</p>
              </div>
              <div>
                <p class="text-lg font-bold">Visits</p>
                <p class="text-gray-500" id="visits-count">0</p>
              </div>
            </div>
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <button class="text-gray-500">
            <i class="fas fa-arrow-left"></i>
          </button>
          <button class="text-gray-500">
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>

    <script>
      const aboutTab = document.getElementById('about-tab');
      const creationsTab = document.getElementById('creations-tab');
      const aboutSection = document.getElementById('about-section');
      const creationsSection = document.getElementById('creations-section');

      function switchTab(selectedTab, selectedSection, otherTab, otherSection) {
        selectedTab.classList.add('selected');
        otherTab.classList.remove('selected');
        selectedSection.classList.remove('hidden');
        otherSection.classList.add('hidden');
      }

      aboutTab.addEventListener('click', () => {
        switchTab(aboutTab, aboutSection, creationsTab, creationsSection);
      });

      creationsTab.addEventListener('click', () => {
        switchTab(creationsTab, creationsSection, aboutTab, aboutSection);
      });

      const urlParams = new URLSearchParams(window.location.search);
      const userId = urlParams.get('userid');

      if (userId) {
        // Fetch all data concurrently
        Promise.all([
          fetch(`https://users.roproxy.com/v1/users/${userId}`).then(response => response.json()),
          fetch(`https://friends.roproxy.com/v1/users/${userId}/followers/count`).then(response => response.json()),
          fetch(`https://friends.roproxy.com/v1/users/${userId}/followings/count`).then(response => response.json()),
          fetch(`https://friends.roproxy.com/v1/users/${userId}/friends/count`).then(response => response.json()),
          fetch(`https://thumbnails.roproxy.com/v1/users/avatar-headshot?userIds=${userId}&size=150x150&format=Png&isCircular=false`)
            .then(response => response.json()),
          fetch(`https://thumbnails.roproxy.com/v1/users/avatar?userIds=${userId}&size=250x250&format=Png&isCircular=false`)
            .then(response => response.json())
        ])
        .then(([userData, followersData, followingData, friendsData, avatarData, outfitData]) => {
          // Update the DOM with the fetched data
          document.getElementById('display-name').innerText = userData.displayName;
          document.getElementById('user-handle').innerText = `@${userData.name}`;
          document.getElementById('join-date').innerText = new Date(userData.created).toLocaleDateString();
          document.getElementById('about').innerText = userData.description || 'No description available.';
          document.getElementById('followers').innerText = `${followersData.count} Followers`;
          document.getElementById('following').innerText = `${followingData.count} Following`;
          document.getElementById('friends').innerText = `${friendsData.count} Friends`;

          // Add the verified badge if the user is verified
          if (userData.hasVerifiedBadge) {
            const verifiedBadge = document.createElement('img');
            verifiedBadge.src = "data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 28 28' fill='none'%3E%3Cg clip-path='url(%23clip0_8_46)'%3E%3Crect x='5.88818' width='22.89' height='22.89' transform='rotate(15 5.88818 0)' fill='%230066FF'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M20.543 8.7508L20.549 8.7568C21.15 9.3578 21.15 10.3318 20.549 10.9328L11.817 19.6648L7.45 15.2968C6.85 14.6958 6.85 13.7228 7.45 13.1218L10.832 9.7398C11.442 9.1388 12.416 9.1388 13.017 9.7398L16.13 12.8528L18.952 10.0308C19.553 9.4298 19.553 8.4568 18.952 7.8558C18.351 7.2548 17.378 7.2548 16.777 7.8558L14.295 10.3378L13.017 9.7398L10.832 9.7398L7.45 13.1218L9.325 14.9968L11.817 17.4888L20.543 8.7508Z' fill='white'/%3E%3C/g%3E%3C/svg%3E";
            verifiedBadge.alt = "Verified";
            verifiedBadge.classList.add("ml-2", "w-6", "h-6", "inline-block");
            document.getElementById('display-name').appendChild(verifiedBadge);
          }

          // Profile Picture and Current Outfit
          document.getElementById('profile-picture').src = avatarData[0].url;
          document.getElementById('current-outfit').src = outfitData[0].url;
        })
        .catch(error => console.error("Error fetching data:", error));
      }
    </script>
  </body>
</html>
